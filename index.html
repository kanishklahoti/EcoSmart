
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Smart Sustainable Living</title>
  <link rel="manifest" href="manifest.json">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("service-worker.js")
      .then(() => console.log("âœ… Service Worker Registered"))
      .catch((err) => console.log("SW Registration Failed", err));
  }
</script>
<style>
/* RESET */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Arial',sans-serif;scroll-behavior:smooth;}
body{overflow-x:hidden;background:#111;color:#fff;line-height:1.6;}

/* NAVIGATION */
nav{position:sticky;top:0;z-index:999;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);
display:flex;justify-content:space-between;align-items:center;padding:20px 60px;border-bottom:2px solid transparent;
border-image:linear-gradient(90deg,#ff6a00,#ee0979,#36d1dc) 1;box-shadow:0 15px 25px rgba(0,0,0,0.3);}
nav .logo{font-size:1.8em;font-weight:bold;background:linear-gradient(90deg,#ff6a00,#ee0979,#36d1dc);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
nav a{color:white;margin-left:25px;text-decoration:none;font-weight:bold;position:relative;transition: all 0.3s ease;}
nav a::after{content:"";position:absolute;width:0;height:2px;bottom:-3px;left:0;
background:linear-gradient(90deg,#ff512f,#dd2476,#36d1dc);transition:0.5s;}
nav a:hover::after{width:100%;}
nav a:hover{color: #ffeb3b; transform: translateY(-4px); text-shadow:0 3px 7px rgba(255,235,59,0.7);}
.nav-left {display: flex; align-items: center; gap: 15px;}
.icon-box img {width: 40px; height: 40px; object-fit: contain; border-radius: 8px;}
.hamburger {display: none;font-size: 2em;cursor: pointer;color: white;}
@media (max-width: 768px) {.nav-links {display: none;position: absolute;top: 80px;right: 20px;background: rgba(0,0,0,0.9);flex-direction: column;gap: 15px;padding: 20px;border-radius: 12px;box-shadow: 0 8px 25px rgba(0,0,0,0.5);} .nav-links a {margin: 0;font-size: 1.2em;} .nav-links.show {display: flex;} .hamburger {display: block;}}

/* HERO */
.hero{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:relative;overflow:hidden;padding:0 20px;margin-bottom:50px;}
.hero::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(270deg,#6a11cb,#2575fc,#ff6a00,#ee0979);background-size:800% 800%;animation:gradientBG 15s ease infinite;z-index:-1;}
@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.hero-inner h1{transition: transform 1.2s ease, text-shadow 1.2s ease;}
.hero-inner:hover h1{transform: translateY(-5px) scale(1.02); text-shadow:0 0 20px rgba(255,255,255,0.8);}
.hero h1{font-size:3em;background:linear-gradient(90deg,#ff6a00,#ee0979,#36d1dc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.hero p{font-size:1.3em;margin:20px 0;}
.hero .btn{padding:15px 35px;font-size:1.2em;border:none;border-radius:50px;cursor:pointer;background:linear-gradient(90deg,#ff512f,#dd2476);color:white;box-shadow: 0 5px 15px rgba(255,81,47,0.4);transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;}
.hero .btn:hover{transform: scale(1.12) translateY(-2px); box-shadow:0 12px 35px rgba(255,81,47,0.6); background: linear-gradient(90deg,#ff7f50,#ee0979);}

/* PARTICLES */
.particle{position:absolute;border-radius:50%;background:rgba(255,255,255,0.6);animation:floatParticle linear infinite; transition: transform 0.3s ease;}
.hero:hover .particle {transform: translateY(-1200px) scale(1.1);}
@keyframes floatParticle{0%{transform:translateY(0) scale(0.5);}100%{transform:translateY(-1000px) scale(1);}}

/* SECTIONS */
section{padding:80px 20px;text-align:center;border-radius:30px;overflow:hidden;margin-bottom:50px; transition: transform 1s ease-out;}
section.show{transform: translateY(0);}
section:not(.show){transform: translateY(15px);}
/* WHY IT MATTERS */
.why{background:linear-gradient(135deg,#ff6a00,#ee0979,#36d1dc,#6a11cb,#ff512f);background-size:1000% 1000%;
animation:gradientBG 20s ease infinite;padding:60px 20px;border-radius:30px;}
.why h2{font-size:2.5em;margin-bottom:20px;background:linear-gradient(90deg,#ff512f,#dd2476,#36d1dc,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.why p{font-size:1.2em;max-width:800px;margin:auto;line-height:1.6;}

@keyframes fadeInPopup {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

/* WHY CHOOSE US */
.choose{background:linear-gradient(45deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#4b0082,#8f00ff);
background-size:400% 400%;animation:gradientBG 25s ease infinite;padding:60px 20px;border-radius:30px;}
.choose h2{font-size:2.5em;margin-bottom:30px;background:linear-gradient(90deg,#ff512f,#dd2476,#36d1dc,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.choose .points{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;}
.choose .point{background:rgba(255,255,255,0.08);padding:20px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
.choose .point h3{margin-bottom:10px;background:linear-gradient(90deg,#ffeb3b,#ff4081,#36d1dc,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

/* PRODUCTS */
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:40px;position:relative;}
.products-title{font-size:3em;font-weight:bold;background:linear-gradient(90deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#8f00ff);background-size:600% 600%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation: rainbowText 6s linear infinite;margin-bottom:40px;}
@keyframes rainbowText{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
.card{background:linear-gradient(145deg,#ffffff22,#f0f0f022);border-radius:20px;overflow:hidden;box-shadow:0 10px 25px rgba(0,0,0,0.3);transition:.5s;position:relative;z-index:0;border:2px solid transparent;}
.card::before{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;background:linear-gradient(270deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#8f00ff);background-size:400% 400%;z-index:-1;border-radius:22px;filter: blur(6px);opacity:0;transition: opacity 0.5s, transform 0.5s;animation: gradientBG 10s ease infinite;}
.card:hover::before{opacity:1; transform: scale(1.02);}
.card:hover{transform:translateY(-12px) scale(1.06); box-shadow:0 25px 50px rgba(0,0,0,0.6);}
.card img{width:100%;height:200px;object-fit:cover;}
.card-content{padding:20px; transition: all 0.6s ease;}
.card-content h3{margin-bottom:10px;background:linear-gradient(90deg,#36d1dc,#5b86e5,#ff6a00,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.price{display:inline-block;font-weight:bold;background:linear-gradient(90deg,#ffeb3b,#ff4081,#36d1dc,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-right:15px;}
.discount{display:inline-block;color:#fff;text-shadow:0 0 5px #000;font-weight:bold;}
.card-content .btn{margin-top:15px;padding:10px 20px;border-radius:30px;background:linear-gradient(90deg,#ff512f,#dd2476);color:white;font-weight:bold;text-decoration:none;transition:0.3s;display:inline-block;}
.card-content .btn:hover{transform:scale(1.05);box-shadow:0 0 20px #dd2476;}

/* CTA */
.cta{background:linear-gradient(135deg,#11998e,#38ef7d,#ff512f,#dd2476);padding:60px 20px;border-radius:30px;}
.cta h2{font-size:2.5em;margin-bottom:20px;}
.cta .btn{padding:20px 50px;border-radius:50px;background:linear-gradient(90deg,#ff512f,#dd2476);color:white;font-weight:bold;text-decoration:none;}

/* CONTACT */
.contact{background:linear-gradient(45deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#4b0082,#8f00ff);background-size:400% 400%;animation:gradientBG 20s ease infinite;padding:60px 20px;border-radius:30px;}
.contact h2{font-size:2.5em;margin-bottom:30px;color:white;}
.contact form{max-width:600px;margin:auto;display:flex;flex-direction:column;}
.contact input,.contact textarea{padding:15px;margin-bottom:15px;border-radius:10px;border:none;}
.contact button{padding:15px;border-radius:50px;background:linear-gradient(90deg,#ff512f,#dd2476);color:white;font-weight:bold;cursor:pointer;}

footer {
  background: linear-gradient(135deg, #2B1A55,#4b23ad);
  padding: 25px 40px;
  margin-top: 40px;
  border-radius: 12px 12px 0 0;
  color: #CO6C84;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: stretch;
  flex-wrap: nowrap;
  box-sizing: border-box;
  border: 2px solid #C06C84; /* Rose glowing border */
  box-shadow: 0 0 12px rgba(192,108,132,0.7);
}

footer .footer-left {
  flex: 70%;
  padding-right: 20px;
  border-right: 2px solid #FFD166; /* vivid gold divider */
}

footer .footer-right {
  flex: 30%;
  text-align: right;
  padding-left: 20px;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 18px;
}

footer .footer-right a {
  color: #FFD166; /* Gold links */
  text-decoration: none;
  font-weight: 700;
  transition: color 0.3s ease;
}

footer .footer-right a:hover {
  color: #FFFFFF; /* White on hover */
}
@media (max-width: 768px) {
  footer {
    flex-direction: column;
    text-align: center;
    padding: 20px;
  }

  footer .footer-left {
    border-right: none;   /* remove divider on small screens */
    border-bottom: 2px solid #FFD166; /* optional: horizontal divider */
    padding: 10px 0;
  }

  footer .footer-right {
    justify-content: center;
    margin-top: 15px;
    padding-left: 0;
    flex-wrap: wrap;
    gap: 12px;
  }
}

/* ------------------ */
/* ADDED ANIMATION CSS (non-destructive) */
.fade-child { opacity:0; transform: translateY(20px); transition: opacity 700ms cubic-bezier(.2,.9,.2,1), transform 700ms cubic-bezier(.2,.9,.2,1); will-change: opacity, transform; }
.fade-child.show{ opacity:1; transform: translateY(0); }
.card .card-content.fade-child { will-change: opacity, transform; }
.fade-child.show.scale { transform: translateY(0) scale(1.01); }
.delay-1 { transition-delay: 0.12s; }
.delay-2 { transition-delay: 0.24s; }
.delay-3 { transition-delay: 0.36s; }
.products-title.fade-child { display:inline-block; }
.cta .fade-child, .contact .fade-child { color: #fff; }
.no-js .fade-child { opacity:1; transform:none; transition:none; }

/* ======= POPUP / OVERLAY - ULTRA PREMIUM ======= */
.visitor-overlay {
  position: fixed;
  inset: 0;
  background: rgba(6,8,13,0.58);
  backdrop-filter: blur(6px) saturate(1.05);
  z-index: 9998;
  display: none;
  opacity: 0;
  transition: opacity 420ms cubic-bezier(.2,.9,.2,1);
}

.visitor-popup {
  position: fixed;
  left: 50%;
  bottom: 24px; /* start near bottom */
  transform: translate(-50%, 120%) scale(0.98);
  width: 92%;
  max-width: 520px;
  z-index: 9999;
  display: none;
  opacity: 0;
  transition: transform 640ms cubic-bezier(.22,.9,.35,1), opacity 420ms ease, box-shadow 420ms ease;
  border-radius: 16px;
  padding: 22px 24px;
  color: #fff;
  box-shadow: 0 30px 80px rgba(4,6,11,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(8px) saturate(1.05);
}

/* when visible - slide up to center */
.visitor-overlay.show { display:block; opacity: 1; }
.visitor-popup.show {
  display:block;
  opacity: 1;
  /* center: translate to vertical center */
  transform: translate(-50%, -50%) scale(1);
  top: 50%;
  bottom: auto;
  left: 50%;
  will-change: transform, opacity;
}

/* content styles */
.visitor-popup h3 { margin-bottom: 8px; font-size:1.1rem; color: #F9F6F7; }
.visitor-popup p { margin-bottom: 14px; color: #dfeff7; line-height:1.4; font-weight:600; }

/* actions */
.visitor-actions { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:8px; }
.popup-link {
  display:inline-block;
  padding:10px 14px;
  border-radius:10px;
  background: linear-gradient(90deg,#2b6b9c,#5b86e5);
  color: #fff;
  text-decoration:none;
  font-weight:800;
  box-shadow: 0 8px 18px rgba(46,125,213,0.08);
}
.popup-accept {
  padding:12px 18px;
  border-radius:12px;
  background: linear-gradient(90deg,#FFD166,#FFB64D);
  color:#2b1a55;
  border:none;
  font-weight:900;
  cursor:pointer;
  box-shadow: 0 14px 40px rgba(255,209,102,0.12);
}

/* subtle entrance sparkle (pseudo) */
.visitor-popup::after{
  content: "";
  position: absolute;
  top: -18px;
  right: -24px;
  width: 140px;
  height: 140px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.06), rgba(255,255,255,0) 30%);
  pointer-events: none;
  transform: rotate(15deg);
  opacity: 0.7;
  border-radius:50%;
}

/* responsive tweaks */
@media (max-width:520px){
  .visitor-popup { padding:16px; max-width:94%; left:50%; bottom: 26px; }
  .popup-link, .popup-accept { width: 100%; text-align:center; }
}

/* Chatbot Icon */
#chatbot-icon {
position: fixed;
bottom: 25px;
right: 25px;
background-color: #2ecc71;
color: white;
font-size: 26px;
padding: 12px 14px;
border-radius: 50%;
cursor: pointer;
box-shadow: 0 4px 10px rgba(0,0,0,0.2);
z-index: 10001;
transition: transform 0.3s ease;
}
#chatbot-icon:hover { transform: scale(1.1); }

/* Chatbot Window */
#chatbot-window {
position: fixed;
bottom: 90px;
right: 25px;
width: 340px;
max-width: calc(100% - 40px);
background: linear-gradient(180deg,#ffffff,#f8fff8);
border-radius: 15px;
box-shadow: 0 4px 40px rgba(0,0,0,0.35);
display: none;
flex-direction: column;
overflow: hidden;
z-index: 10002;
animation: fadeIn 0.38s ease;
border: 1px solid rgba(0,0,0,0.06);
}

/* header */
#chatbot-header {
background: linear-gradient(90deg,#20b559,#2ecc71);
color: white;
padding: 10px 12px;
font-size: 16px;
display: flex;
justify-content: space-between;
align-items: center;
}
#chatbot-header small { opacity: 0.9; font-weight:600; }

/* quick prompts (chips) */
#chatbot-chips { display:flex; gap:8px; padding:10px; overflow-x:auto; background: linear-gradient(180deg,#f3fff3,#ffffff); }
.chip {
  background:#e9fff0;
  color:#0b3a16;
  padding:6px 10px;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
  white-space:nowrap;
  border:1px solid rgba(43,197,105,0.08);
  box-shadow: 0 6px 18px rgba(43,197,105,0.06);
  flex: 0 0 auto;
}

/* messages area */
#chatbot-messages {
padding: 12px;
height: 220px;
overflow-y: auto;
font-size: 14px;
display:flex;
flex-direction:column;
gap:8px;
background: transparent;
}

/* message bubbles */
.bot-message, .user-message {
margin: 0;
padding: 10px 12px;
border-radius: 12px;
display: inline-block;
max-width: 85%;
line-height:1.3;
}
.bot-message {
background: #e3f9e5;
color: #08401a;
align-self: flex-start;
box-shadow: 0 8px 24px rgba(0,0,0,0.06);
}
.user-message {
background: linear-gradient(90deg,#16b85a,#2ecc71);
color: white;
align-self: flex-end;
box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

/* input row */
#chatbot-input {
display: flex;
gap:8px;
border-top: 1px solid rgba(0,0,0,0.06);
padding: 10px;
background: linear-gradient(180deg,#ffffff,#f3fff3);
}
#chatbot-input input {
flex: 1;
border: 1px solid rgba(0,0,0,0.06);
padding: 10px 12px;
font-size: 14px;
outline: none;
border-radius: 10px;
background: white;
}
#chatbot-input button {
background: #2ecc71;
border: none;
color: white;
padding: 9px 12px;
cursor: pointer;
font-size: 16px;
border-radius: 10px;
display:flex;
align-items:center;
justify-content:center;
}
#voice-btn.recording {
  background: linear-gradient(90deg,#ff6b6b,#ff9a9a);
  box-shadow: 0 8px 30px rgba(255,80,80,0.12) inset;
  animation: pulse 1s infinite;
}
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.04); } 100% { transform: scale(1); } }

@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* small screens tweak to not cover everything */
@media (max-width:420px){
  #chatbot-window { right: 12px; left: 12px; width:auto; bottom: 84px; }
  #chatbot-messages { height: 180px; }
}
</style>

</head>
<body class="no-js">

<!-- NAV -->
<nav>
  <div class="nav-left">
    <div class="icon-box">
      <img src="ecosmart.jpg" alt="EcoSmart Icon">
    </div>
    <div class="logo">EcoSmart</div>
  </div>
  <div class="nav-links">
    <a href="#hero">Home</a>
    <a href="#why">Why It Matters</a>
    <a href="#choose">Why Choose Us</a>
    <a href="#products">Top Picks</a>
    <a href="#cta">Explore</a>
    <a href="Aboutus.html" target="_self"> About Us </a>
    <a href="#contact">Contact</a>
  </div>
<div class="hamburger" onclick="toggleMenu()">
  â˜°
</div>

</nav>

<!-- VISITOR CONSENT POPUP (ULTRA PREMIUM : slides up from bottom to center) -->
<div id="visitorOverlay" class="visitor-overlay" aria-hidden="true"></div>

<div id="visitorPopup" class="visitor-popup" role="dialog" aria-modal="true" aria-labelledby="visitorTitle" aria-describedby="visitorDesc">
  <h3 id="visitorTitle">ðŸ‘‹ Welcome to EcoSmart</h3>
  <p id="visitorDesc">Please agree to our <strong>Terms &amp; Conditions</strong> and <strong>Privacy Policy</strong> to continue browsing the website.</p>

  <div class="visitor-actions">
    <a href="tnc.html" target="_blank" class="popup-link" rel="noopener">View Terms &amp; Conditions</a>
    <a href="pnp.html" target="_blank" class="popup-link" rel="noopener">View Privacy Policy</a>
    <button id="acceptPopupBtn" class="popup-accept" aria-label="Agree and continue">I Agree</button>
  </div>
</div>

<!-- HERO -->
<section class="hero" id="hero">
  <div class="hero-inner">
    <h1 style="font-size:2em; color:white; margin-bottom:10px; text-shadow: 0 0 10px rgba(255,255,255,0.8);">Smart Sustainable Sphere</h1>
    <h1>Live Smart. Live Green.</h1>
    <p>Transform your daily life with sustainable technology. Energy-efficient, solar-powered, AI-driven smart products.</p>
    <button class="btn" onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})">Explore Top Products</button>
  </div>
</section>

<script>
/* particles */
for(let i=0;i<50;i++){
    let p=document.createElement('div');
    p.classList.add('particle');
    p.style.width = p.style.height = (Math.random()*6+2)+'px';
    p.style.left = Math.random()*100+'%';
    p.style.top = Math.random()*100+'%';
    p.style.animationDuration = (Math.random()*10+5)+'s';
    p.style.background = 'rgba(255,255,255,'+Math.random()+')';
    document.querySelector('.hero').appendChild(p);
}
</script>

<!-- ðŸŒ¿ EcoSmart AI Chat Assistant -->
<div id="chatbot-icon" role="button" aria-label="Open EcoSmart Assistant">ðŸ’¬</div>

<div id="chatbot-window" role="dialog" aria-modal="false" aria-label="EcoSmart Assistant">
  <div id="chatbot-header">
    <div>
      <strong>EcoSmart Assistant</strong>
      <div style="font-size:11px"><small>Ask about products, contact, or policies</small></div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="minimize-chat" title="Minimize" style="background:transparent;border:none;color:white;font-size:18px;cursor:pointer">â€”</button>
      <button id="close-chat" title="Close" style="background:transparent;border:none;color:white;font-size:18px;cursor:pointer">âœ–</button>
    </div>
  </div>

  <!-- quick suggestion chips -->
  <div id="chatbot-chips" aria-hidden="false">
    <div class="chip" data-msg="Why it matters">Why it matters</div>
    <div class="chip" data-msg="Why choose us">Why choose us</div>
    <div class="chip" data-msg="Contact details">Contact</div>
    <div class="chip" data-msg="See all products">See all products</div>
    <div class="chip" data-msg="Privacy Policy">Privacy Policy</div>
    <div class="chip" data-msg="Terms and Conditions">Terms & Conditions</div>
    <div class="chip" data-msg="About us">About Us</div>
  </div>

  <div id="chatbot-messages" aria-live="polite">
    <div class="bot-message">Hello! ðŸ‘‹ I'm your EcoSmart assistant.<br>Tap a suggestion or type a question â€” you can also use voice. </div>
  </div>

  <div id="chatbot-input">
    <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off" />
    <button id="voice-btn" title="Record voice" aria-label="Start voice input">ðŸŽ¤</button>
    <button id="send-btn" title="Send message" aria-label="Send message">âž¤</button>
  </div>
</div>

<script>
/* Chatbot logic, voice integration, TTS, quick chips, improved toggle behavior, and accessibility */

/* Elements */
const chatIcon = document.getElementById("chatbot-icon");
const chatWindow = document.getElementById("chatbot-window");
const closeChat = document.getElementById("close-chat");
const minimizeChat = document.getElementById("minimize-chat");
const sendBtn = document.getElementById("send-btn");
const userInput = document.getElementById("user-input");
const chatMessages = document.getElementById("chatbot-messages");
const voiceBtn = document.getElementById("voice-btn");
const chips = document.querySelectorAll('.chip');

/* Utility: append message */
function appendMessage(text, who='bot') {
  const el = document.createElement('div');
  el.className = who === 'bot' ? 'bot-message' : 'user-message';
  // allow line breaks
  el.innerHTML = text.replace(/\n/g,'<br>');
  chatMessages.appendChild(el);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return el;
}

/* Basic bot replies (expandable) */
const botReplies = {
  "hi": "Hello there! ðŸŒ± How can I help you today?",
  "hello": "Hi! ðŸ‘‹ I'm here to help you explore EcoSmart products.",
  "products": "We offer Smart Solar Fans, Smart Waste Bins, Automatic Plant Watering Systems and more. Click 'See all products' to browse.",
  "see all products": "Click here to view all products: <a href='all-products.html' style='color:#0b3a16;font-weight:800;'>All Products</a>",
  "why it matters": "Smart sustainable tech reduces energy use, lowers bills, and helps the planet â€” small changes compound into large impact.",
  "why choose us": "Premium materials, AI integrations, and tested energy savings. We focus on durability and sustainability.",
  "contact": "You can reach us at +91 9920190050 or email: kanishklahoti9@gmail.com",
  "contact details": "You can reach us at +91 9920190050 or email: kanishklahoti9@gmail.com",
  "privacy policy": "Our Privacy Policy is available here: <a href='pp.html' style='color:#0b3a16;font-weight:800;'>Privacy Policy</a>",
  "terms and conditions": "Read our Terms & Conditions: <a href='tc.html' style='color:#0b3a16;font-weight:800;'>Terms & Conditions</a>",
  "about us": "Learn about EcoSmart on our About page: <a href='Aboutus.html' style='color:#0b3a16;font-weight:800;'>About Us</a>",
  "accessibility": "We aim to keep the site accessible â€” please contact us if you need help accessing content.",
  "eco": "EcoSmart helps make sustainable living easier with smart technology.",
  "sustainability": "Sustainability is at our core â€” we design products to minimize carbon footprint.",
  "bye": "Goodbye! ðŸŒ¿ Stay eco-smart!",
  "default": "I'm still learning ðŸ’¡ â€” try asking about products, contact details, or policies. You can also tap the suggestions above."
};

/* TTS for bot messages (ultra-premium touch) */
function speak(text) {
  if (!('speechSynthesis' in window)) return;
  try {
    const utter = new SpeechSynthesisUtterance(text.replace(/<[^>]*>?/gm, '')); // strip html
    utter.lang = 'en-US';
    utter.rate = 1;
    utter.pitch = 1;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utter);
  } catch (e) {
    console.warn('TTS failed', e);
  }
}

/* process query */
function processMessage(raw) {
  const message = raw.trim();
  if (!message) return;
  // display user
  appendMessage(escapeHtml(message), 'user');
  // compute reply key
  const key = message.toLowerCase().replace(/[?!.]*/g,'').trim();
  let reply = botReplies[key] || botReplies["default"];
  // Append reply
  setTimeout(()=> {
    const el = appendMessage(reply, 'bot');
    // speak the response (voice)
    speak(typeof reply === 'string' ? reply : '');
    // if reply contains a link we want to add small focusable control behavior (no need here)
  }, 450);
}

/* helper to escape but allow limited html for links in replies */
function escapeHtml(str){
  // allow <a> tags (we will trust our own replies); for user text, escape everything
  const tmp = document.createElement('div');
  tmp.textContent = str;
  return tmp.innerHTML;
}

/* open / close logic with focus management */
function openChat() {
  chatWindow.style.display = 'flex';
  chatWindow.setAttribute('aria-modal','true');
  userInput.focus();
  // add small entrance message if first time
}
function closeChatWindow() {
  chatWindow.style.display = 'none';
  chatWindow.setAttribute('aria-modal','false');
  chatIcon.focus();
}
function minimizeChatWindow() {
  // minimize keeps open but reduces height (simple behavior: hide messages & chips)
  const visible = chatMessages.style.display !== 'none';
  if (visible) {
    chatMessages.style.display = 'none';
    document.getElementById('chatbot-chips').style.display = 'none';
    document.getElementById('chatbot-input').style.display = 'none';
    minimizeChat.textContent = '+';
  } else {
    chatMessages.style.display = 'flex';
    document.getElementById('chatbot-chips').style.display = 'flex';
    document.getElementById('chatbot-input').style.display = 'flex';
    minimizeChat.textContent = 'â€”';
    userInput.focus();
  }
}

/* event hookups */
chatIcon.addEventListener('click', ()=> {
  const isShown = chatWindow.style.display === 'flex';
  if (!isShown) openChat(); else closeChatWindow();
});
closeChat.addEventListener('click', closeChatWindow);
minimizeChat.addEventListener('click', minimizeChatWindow);

/* send on button or enter */
sendBtn.addEventListener('click', ()=>{
  const val = userInput.value;
  if (!val.trim()) return;
  processMessage(val);
  userInput.value = '';
});
userInput.addEventListener('keydown', (e)=>{
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendBtn.click();
  }
});

/* chips behavior */
chips.forEach(c=>{
  c.addEventListener('click', ()=> {
    const msg = c.getAttribute('data-msg');
    userInput.value = msg;
    sendBtn.click();
  });
});

/* Voice recognition (Web Speech API) and UI */
let recognition = null;
let listening = false;

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = 'en-IN'; // adjust to region. Use en-US if preferred.
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onstart = () => {
    listening = true;
    voiceBtn.classList.add('recording');
    voiceBtn.title = 'Listening... click to stop';
  };
  recognition.onend = () => {
    listening = false;
    voiceBtn.classList.remove('recording');
    voiceBtn.title = 'Record voice';
  };
  recognition.onerror = (ev) => {
    console.warn('Speech error', ev);
    listening = false;
    voiceBtn.classList.remove('recording');
    voiceBtn.title = 'Record voice';
  };
  recognition.onresult = (ev) => {
    if (!ev.results || !ev.results[0] || !ev.results[0][0]) return;
    const transcript = ev.results[0][0].transcript;
    // place into input and send
    userInput.value = transcript;
    sendBtn.click();
  };

  voiceBtn.addEventListener('click', () => {
    try {
      if (listening) {
        recognition.stop();
        return;
      }
      recognition.start();
    } catch (e) {
      console.warn('Voice start failed', e);
    }
  });
} else {
  // hide voice button for unsupported browsers
  voiceBtn.style.display = 'none';
}

/* speak welcome on open */
chatIcon.addEventListener('click', () => {
  // brief welcome TTS
  speak('Welcome to EcoSmart. Ask about products, contact details or policies.');
});

/* Accessibility: close chat on Escape when focused inside */
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    if (chatWindow.style.display === 'flex') closeChatWindow();
  }
});

/* Small helper to auto-open chat once consent given (optional) - keep unobtrusive */
/* End Chatbot script */
</script>

<!-- WHY IT MATTERS -->
<section class="why" id="why">
 <h2 class="fade-target">Why Smart Sustainable Tech Matters</h2>
 <p class="fade-target">Climate change is real, and so are the solutions. By integrating smart sustainable technology into everyday life, we can save energy, cut costs, and build a greener future for generations to come.</p>
</section>

<!-- WHY CHOOSE US -->
<section class="choose" id="choose">
 <h2 class="fade-target">Why Choose Us</h2>
 <div class="points">
   <div class="point fade-target"><h3>ðŸŒ± Eco-Friendly</h3><p>Products designed to reduce energy consumption and carbon footprint.</p></div>
   <div class="point fade-target"><h3>âš¡ Innovation</h3><p>Cutting-edge AI and IoT integrations for smarter living.</p></div>
   <div class="point fade-target"><h3>ðŸ’Ž Premium Quality</h3><p>Durable, modern, and sleek designs with advanced features.</p></div>
 </div>
</section>

<!-- PRODUCTS -->
<section id="products">
 <h1 class="products-title fade-target">Our Top Smart Products</h1>
 <div class="products">
   <div class="card">
     <img src="automaticcurtains.jpg?text=Automatic+Curtains" alt="">
     <div class="card-content fade-target">
       <h3>Automatic Curtains</h3>
       <p>Solar-powered smart curtain control.</p>
       <span class="price">â‚¹5999</span><span class="discount">60% OFF</span><br>
       <a href="product1.html" class="btn">View Details</a>
     </div>
   </div>
   <div class="card">
     <img src="smartfoodmaker1.webp?text=Smart+Food+Maker" alt="">
     <div class="card-content fade-target">
       <h3>Smart Food Maker</h3>
       <p>Cook meals efficiently and eco-friendly.</p>
       <span class="price">â‚¹8499</span><span class="discount">35% OFF</span><br>
       <a href="product9.html" class="btn">View Details</a>
     </div>
   </div>
   <div class="card">
     <img src="flooring1.jpg?text=Solar+LED+Lights" alt="">
     <div class="card-content fade-target">
       <h3> Energy-Harvesting Flooring</h3>
       <p>Flooring that generates electricity </p>
       <span class="price">â‚¹8999</span><span class="discount">30% OFF</span><br>
       <a href="product8.html" class="btn">View Details</a>
     </div>
   </div>
   <div class="card">
     <img src="Smartthermostat.jpg?text=Smart+Thermostat" alt="">
     <div class="card-content fade-target">
       <h3>Smart Thermostat</h3>
       <p>Save energy with automated climate control.</p>
       <span class="price">â‚¹4999</span><span class="discount">60% OFF</span><br>
       <a href="product2.html" class="btn">View Details</a>
     </div>
   </div>
   <div class="card">
     <img src="wadrobe.webp?text=Intelligent+ Wadrobe" alt="">
     <div class="card-content fade-target">
       <h3> Intelligent Wardrobe</h3>
       <p>A closet that steams, deodorizes, and organizes clothes automatically.</p>
       <span class="price">â‚¹24999</span><span class="discount">60% OFF</span><br>
       <a href="product6.html" class="btn">View Details</a>
     </div>
   </div>
   <div class="card">
     <img src="watering1.jpg?text=Smart+Air+Purifier" alt="">
     <div class="card-content fade-target">
       <h3>Automatic Plant Watering System</h3>
       <p>Solar-powered drip irrigation with app scheduling.</p>
       <span class="price">â‚¹19999</span><span class="discount">20% OFF</span><br>
       <a href="product15.html" class="btn">View Details</a>
     </div>
   </div>
 </div>
</section>

<!-- CTA -->
<section class="cta" id="cta">
 <h2 class="fade-target">Discover the Full Collection</h2>
 <a href="all-products.html" class="btn fade-target">See All Products</a>
</section>

<!-- CONTACT -->
<section class="contact" id="contact">
 <h2 class="fade-target">Contact Us</h2>
 <form action="https://formspree.io/f/xqaybodj" method="POST" class="fade-target">
   <input type="text" name="firstName" placeholder="First Name" required>
   <input type="text" name="lastName" placeholder="Last Name" required>
   <input type="email" name="email" placeholder="Email" required>
   <textarea name="message" placeholder="Your Message" rows="5" required></textarea>
   <button type="submit">Submit</button>
 </form>
</section>

<footer>
  <div class="footer-left">
    Â© 2025 EcoSmart | All Rights Reserved| 
    Contact: +91 9920190050 <br>Email: kanishklahoti9@gmail.com<br>
<p style="font-size: 10px; color:#888;">
âš  Disclaimer: This is a demo website for project purposes only.
    Orders, payments, and deliveries are not functional.</p>
  </div>
  <div class="footer-right">
    <a href="pp.html" target="_blank">Privacy Policy</a><br>
    <a href="tc.html" target="_blank">Terms and Conditions</a><br>
    <a href="as.html" target="_blank">Accessibility Statement</a>
  </div>
</footer>

<!-- Transitions & consent JS -->
<script>
(function () {
  document.body.classList.remove('no-js');
  const targets = Array.from(document.querySelectorAll('.fade-target'));
  targets.forEach(el => el.classList.add('fade-child'));
  const observerOptions = { threshold: 0.12 };
  const revealObserver = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('show');
        obs.unobserve(entry.target);
      }
    });
  }, observerOptions);
  document.querySelectorAll('.fade-child').forEach(el => { if(!el.closest('.products')) revealObserver.observe(el); });
  const productsSection = document.querySelector('#products');
  if(productsSection){
    const productObserver = new IntersectionObserver((entries, po) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          const cardContents = productsSection.querySelectorAll('.card .card-content.fade-child');
          cardContents.forEach((cc,i)=>setTimeout(()=>cc.classList.add('show','scale'), i*140));
          po.unobserve(productsSection);
        }
      });
    },{threshold:0.18});
    productObserver.observe(productsSection);
  }
})();
function toggleMenu() {
  document.querySelector(".nav-links").classList.toggle("show");
}

/* ===== POPUP: slide up from bottom to center with persisted consent (localStorage) ===== */
window.addEventListener('load', () => {
  const CONSENT_KEY = 'ecoSmartConsent_v1';
  const overlay = document.getElementById('visitorOverlay');
  const popup = document.getElementById('visitorPopup');
  const acceptBtn = document.getElementById('acceptPopupBtn');

  // If consent already given, don't show popup
  try {
    if (localStorage.getItem(CONSENT_KEY) === 'accepted') {
      if (overlay) overlay.style.display = 'none';
      if (popup) popup.style.display = 'none';
      return;
    }
  } catch (err) {
    console.warn('localStorage unavailable:', err);
  }

  if (!overlay || !popup || !acceptBtn) return;

  // show overlay & popup so animations can run
  overlay.style.display = 'block';
  popup.style.display = 'block';

  // tiny delay to allow paint then animate into center
  requestAnimationFrame(() => {
    setTimeout(() => {
      overlay.classList.add('show');
      popup.classList.add('show');
      overlay.setAttribute('aria-hidden', 'false');
      popup.setAttribute('aria-hidden', 'false');
      try { acceptBtn.focus({preventScroll:true}); } catch (e) {}
    }, 30);
  });

  // Accept button: persist consent and hide with animation
  acceptBtn.addEventListener('click', () => {
    try { localStorage.setItem(CONSENT_KEY, 'accepted'); } catch (err) { console.warn('Cannot persist consent:', err); }
    popup.classList.remove('show');
    overlay.classList.remove('show');
    setTimeout(() => {
      popup.style.display = 'none';
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden', 'true');
      popup.setAttribute('aria-hidden', 'true');
    }, 480);
  });

  // Prevent overlay click from closing (require explicit consent)
  overlay.addEventListener('click', (e) => { e.stopPropagation(); });

  // Allow Escape to accept & close (optional)
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && popup.classList.contains('show')) {
      acceptBtn.click();
    }
  });
});
</script>

<!-- =========================
  EcoSmart Auth + Loading Overlay
  Full-featured: session, expiry, strong passwords,
  per-user data, loading overlay, logout, confirm guest
  ========================= -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
/* Popup / basic UI */
#authPopup {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex; align-items: center; justify-content: center;
  z-index: 9999;
}
#authBox {
  background: linear-gradient(135deg,#38ef7d,#11998e);
  padding: 28px; border-radius: 18px; width: 360px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.45); text-align: center;
  color: white; animation: slideUp .45s ease-out;
}
#authBox input { width: 92%; padding:10px; margin:10px 0; border:none; border-radius:8px; }
.auth-btn { padding:10px 18px; border:none; border-radius:8px; background:#FFD166; color:#2B1A55; font-weight:bold; cursor:pointer; margin:6px; }
.small-link { color:#FFD166; cursor:pointer; display:inline-block; margin-top:10px; }

/* Loading overlay (full-screen) */
#loadingOverlay {
  position: fixed; inset: 0; z-index: 10000;
  display: none; align-items:center; justify-content:center;
  background: rgba(10,10,10,0.95);
  color: white; flex-direction: column;
}
.loading-bg {
  position:absolute; inset:0; background-size:cover; background-position:center;
  opacity:0; transition: opacity 1s ease;
  filter: blur(1px) brightness(.65);
}
.loading-content {
  position: relative; z-index: 2; text-align:center; max-width:90%;
}
.loading-title { font-size:32px; font-weight:700; letter-spacing:1px; margin-bottom:8px; }
.loading-sub { margin-bottom:12px; font-size:16px; opacity:0.95; }
.loading-facts { margin-top:18px; font-size:14px; opacity:0.9; }

/* spinner */
.spinner {
  border: 3px solid rgba(255,255,255,0.15);
  border-top: 3px solid white;
  border-radius: 50%;
  width: 18px; height: 18px;
  display: inline-block;
  animation: spin 1s linear infinite;
  vertical-align: middle;
  margin-right:8px;
}


/* Carousel styles for loading overlay (add inside your existing style tag) */
#ecoCarouselWrapper {
  width: 320px;
  height: 110px;
  margin: 16px auto 6px auto;
  overflow: hidden;
  border-radius: 12px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.08); /* subtle layer */
}
#ecoCarouselTrack {
  display: flex;
  gap: 12px;
  align-items: center;
  transition: transform 0.6s ease-in-out;
  will-change: transform;
}
.carousel-card {
  min-width: 160px;
  height: 90px;
  border-radius: 10px;
  background-size: cover;
  background-position: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.18);
  flex-shrink: 0;
  transform-origin: center;
  transition: transform 0.6s ease;
}
.carousel-card.active { transform: scale(1.02); }

/* logout button placement */
#ecoLogoutBtn {
  position: fixed; top: 18px; right: 18px; z-index: 1001;
  background:#11998e; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; display:none;
  box-shadow: 0 6px 18px rgba(0,0,0,0.2);
}

/* confirm guest overlay */
#guestConfirm {
  position: fixed; inset:0; display:none; z-index:10002; align-items:center; justify-content:center;
  background: rgba(0,0,0,0.6);
}
#guestConfirmBox {
  background:white; color:#111; padding:20px; border-radius:12px; width:320px; text-align:center;
}
.gc-btn { padding:8px 14px; border-radius:8px; border:none; cursor:pointer; margin:8px; }

/* transitions */
@keyframes slideUp { from{ transform: translateY(30px); opacity:0 } to{ transform:translateY(0); opacity:1 } }
@keyframes spin { to{ transform: rotate(360deg); } }

/* responsive */
@media (max-width:480px){
  #authBox { width:92%; padding:20px; }
  .loading-title { font-size:24px; }
}
</style>

<!-- Loading overlay -->
<div id="loadingOverlay">
  <div class="loading-bg" id="loadingBg0"></div>
  <div class="loading-bg" id="loadingBg1"></div>
  <div class="loading-bg" id="loadingBg2"></div>

  <div class="loading-content">
    <div class="loading-title">EcoSmart</div>
    <div class="loading-sub"><span class="spinner"></span> Loading your dashboard...</div>
    <div class="loading-facts" id="loadingFact">With EcoSmart you help save thousands of tons of COâ‚‚.</div>
  </div>
</div>

<!-- Guest confirm -->
<div id="guestConfirm">
  <div id="guestConfirmBox">
    <h3 style="margin:0 0 8px 0;">Continue as guest?</h3>
    <p style="margin:0 0 16px 0;">You won't be able to save progress or access personalized features unless you log in.</p>
    <div>
      <button class="gc-btn" id="guestCancel" style="background:#eee;">Go Back</button>
      <button class="gc-btn" id="guestContinue" style="background:#11998e;color:white;">Continue Anyway</button>
    </div>
  </div>
</div>

<!-- Auth popup -->
<div id="authPopup" aria-hidden="false">
  <div id="authBox">
    <h2 id="authTitle">Welcome to EcoSmart</h2>
    <p id="authSubtitle">Please log in to continue</p>

    <input type="email" id="emailInput" placeholder="Email" autocomplete="username">
    <input type="password" id="passwordInput" placeholder="Password" autocomplete="current-password">
    <input type="text" id="verifyCodeInput" placeholder="Verification Code" style="display:none;">

    <div style="margin-top:8px;">
      <button id="loginBtn" class="auth-btn">Login</button>
      <button id="signupBtn" class="auth-btn">New user? Sign Up</button>
    </div>

    <div style="margin-top:6px;">
      <button id="sendCodeBtn" class="auth-btn" style="display:none;">Send Verification Code</button>
      <button id="viewBtn" class="auth-btn">View without Login</button>
    </div>

    <p style="margin-top:10px;"><a id="forgotPasswordLink" class="small-link">Forgot Password?</a></p>
  </div>
</div>

<!-- Logout button -->
<button id="ecoLogoutBtn">ðŸŒ± Logout</button>

<script>
/* ------------------------- Configuration ------------------------- */
emailjs.init("gIO73_6-evFQpi5nl"); // your EmailJS public key
const EMAIL_SERVICE = "service_e0pxoa8";
const EMAIL_TEMPLATE = "template_blpec5p";

/* ------------------------- Elements ------------------------- */
const authPopup = document.getElementById('authPopup');
const authBox = document.getElementById('authBox');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const sendCodeBtn = document.getElementById('sendCodeBtn');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const verifyCodeInput = document.getElementById('verifyCodeInput');
const authTitle = document.getElementById('authTitle');
const authSubtitle = document.getElementById('authSubtitle');
const viewBtn = document.getElementById('viewBtn');
const forgotLink = document.getElementById('forgotPasswordLink');
const loadingOverlay = document.getElementById('loadingOverlay');
const loadingBg0 = document.getElementById('loadingBg0');
const loadingBg1 = document.getElementById('loadingBg1');
const loadingBg2 = document.getElementById('loadingBg2');
const loadingFact = document.getElementById('loadingFact');
const guestConfirm = document.getElementById('guestConfirm');
const guestCancel = document.getElementById('guestCancel');
const guestContinue = document.getElementById('guestContinue');
const logoutBtn = document.getElementById('ecoLogoutBtn');

/* ------------------------- State ------------------------- */
let verificationCode = null;
let codeExpiry = null; // timestamp in ms
let resetMode = false;
let signupMode = false;
let bgIndex = 0;
let factIndex = 0;

/* Placeholder images/facts - replace later with real URLs/facts if needed */
const placeholderImages = [
  "Smartthermostat3.jpg?text=EcoSmart+Product+1",
  "smartcamera2.jpg?text=EcoSmart+Product+2",
  "smartfoodmaker1.webp?text=EcoSmart+Product+3"
];
const placeholderFacts = [
  "With EcoSmart you save thousands of tons of COâ‚‚ every year.",
  "EcoSmart users reduce energy bills while helping the planet.",
  "Join thousands of households making a measurable impact."
];

/* ------------------------- Utility Helpers ------------------------- */
function saveUsers(users) {
  localStorage.setItem('ecoUsers', JSON.stringify(users));
}
function getUsers() {
  return JSON.parse(localStorage.getItem('ecoUsers')) || [];
}
function setCurrentUser(email) {
  localStorage.setItem('ecoCurrentUser', email);
}
function getCurrentUser() {
  return localStorage.getItem('ecoCurrentUser');
}
function clearCurrentUser() {
  localStorage.removeItem('ecoCurrentUser');
}
function ensureUserData(email) {
  // ecoUserData stored as object keyed by email
  let data = JSON.parse(localStorage.getItem('ecoUserData') || "{}");
  if (!data[email]) {
    data[email] = { preferences: {}, createdAt: Date.now() };
    localStorage.setItem('ecoUserData', JSON.stringify(data));
  }
}
function sleep(ms){ return new Promise(res => setTimeout(res, ms)); }

/* ------------------------- Page init: session-based login ------------------------- */
document.addEventListener('DOMContentLoaded', () => {
  // If someone is already logged in -> skip popup and load dashboard
  const current = getCurrentUser();
  if (current) {
    // hide popup, show logout button and load dashboard
    authPopup.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
    showLoadingAndLoad(current);
  } else {
    // show popup for manual login/signup
    authPopup.style.display = 'flex';
  }
});

/* ------------------------- Signup mode ------------------------- */
signupBtn.addEventListener('click', () => {
  resetMode = false;
  signupMode = true;
  authTitle.textContent = "Create Your Account";
  authSubtitle.textContent = "Enter your email, set a password & verify your account";
  passwordInput.placeholder = "Set a Password";
  verifyCodeInput.style.display = 'none';
  sendCodeBtn.style.display = 'inline-block';
  loginBtn.textContent = 'Sign Up';
  signupBtn.style.display = 'none';
  forgotLink.style.display = 'none';
});

/* ------------------------- Send verification code (signup or reset) ------------------------- */
sendCodeBtn.addEventListener('click', async () => {
  let email = (emailInput.value || "").trim().replace(/\s+/g, '');
  if (!email) { alert("Please enter your email."); emailInput.focus(); return; }

  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(email)) { alert("Please enter a valid email."); emailInput.focus(); return; }

  // generate code + expiry (5 minutes)
  verificationCode = Math.floor(100000 + Math.random() * 900000);
  codeExpiry = Date.now() + 5 * 60 * 1000; // 5 minutes from now

  const params = { to_email: email, verification_code: verificationCode };

  sendCodeBtn.disabled = true;
  sendCodeBtn.textContent = "Sending...";

  try {
    await emailjs.send(EMAIL_SERVICE, EMAIL_TEMPLATE, params);
    alert("âœ… Verification code sent! (expires in 5 minutes)");
    verifyCodeInput.style.display = 'block';
    sendCodeBtn.style.display = 'none';
  } catch (err) {
    console.error("EmailJS error:", err);
    alert("âš  Could not send verification code. Check email & EmailJS setup.");
  } finally {
    sendCodeBtn.disabled = false;
    sendCodeBtn.textContent = "Send Verification Code";
  }
});

/* ------------------------- Strong password rule check ------------------------- */
function strongPassword(password) {
  if (!password) return false;
  if (password.length < 6) return false;
  if (!/[A-Z]/.test(password)) return false;
  if (!/[0-9]/.test(password)) return false;
  return true;
}

/* ------------------------- Login / Signup / Reset handler ------------------------- */
loginBtn.addEventListener('click', async () => {
  const email = (emailInput.value || "").trim();
  const password = (passwordInput.value || "").trim();
  let users = getUsers();

  // basic presence checks; for resetMode we allow empty password until verification step
  if (!email || (!password && !resetMode)) {
    alert("Please fill all required fields.");
    return;
  }

  // If verification code is visible, check expiry and correctness first
  if (verifyCodeInput.style.display === 'block') {
    if (!verificationCode || !codeExpiry || Date.now() > codeExpiry) {
      alert("Verification code expired. Please request a new code.");
      verifyCodeInput.style.display = 'none';
      sendCodeBtn.style.display = 'inline-block';
      return;
    }
    if (String(verifyCodeInput.value).trim() !== String(verificationCode)) {
      alert("âŒ Incorrect verification code.");
      return;
    }
    // Code is valid -> proceed depending on mode
    if (resetMode) {
      // Reset password: passwordInput must contain the new password now
      if (!strongPassword(password)) {
        alert("Please set a stronger password (min 6 chars, 1 uppercase, 1 number).");
        return;
      }
      const idx = users.findIndex(u => u.email === email);
      if (idx === -1) { alert("User not found."); return; }
      users[idx].password = password;
      saveUsers(users);
      alert("âœ… Password reset successful! Logging you in...");
      // login the user
      setCurrentUser(email);
      ensureUserData(email);
      showLoadingAndLoad(email);
      resetMode = false;
      verifyCodeInput.style.display = 'none';
      passwordInput.placeholder = "Password";
      loginBtn.textContent = 'Login';
      signupBtn.style.display = 'inline-block';
      forgotLink.style.display = 'inline-block';
      return;
    }
    if (signupMode) {
      // Sign up: validate password strength
      if (!strongPassword(password)) {
        alert("Please choose a stronger password (min 6 chars, 1 uppercase, 1 number).");
        return;
      }
      if (users.some(u => u.email === email)) {
        alert("This email is already registered. Please log in.");
        return;
      }
      users.push({ email, password });
      saveUsers(users);
      alert("ðŸŽ‰ Signup complete! Logging you in...");
      setCurrentUser(email);
      ensureUserData(email);
      showLoadingAndLoad(email);
      // reset UI state
      signupMode = false;
      verifyCodeInput.style.display = 'none';
      sendCodeBtn.style.display = 'none';
      loginBtn.textContent = 'Login';
      signupBtn.style.display = 'inline-block';
      forgotLink.style.display = 'inline-block';
      passwordInput.placeholder = "Password";
      return;
    }
  }

  // Normal login flow (no visible verify input)
  if (!resetMode && !signupMode) {
    const user = users.find(u => u.email === email && u.password === password);
    if (user) {
      alert("ðŸŒ¿ Welcome back, " + email + "!" + "Loading your Dahboard");
      setCurrentUser(email);
      ensureUserData(email);
      showLoadingAndLoad(email);
      return;
    } else {
      alert("User not found or incorrect password. Please sign up first.");
    }
  }
});

/* ------------------------- Forgot password (login view only) ------------------------- */
forgotLink.addEventListener('click', () => {
  if (signupMode) return; // shouldn't be visible in signup mode, but guard anyway
  const email = prompt("Enter your registered email:");
  if (!email) return;
  const users = getUsers();
  if (!users.some(u => u.email === email.trim())) {
    alert("âŒ Email not found. Please sign up first.");
    return;
  }
  // set reset mode and send code (reuse sending logic)
  resetMode = true;
  signupMode = false;
  emailInput.value = email.trim();
  verificationCode = Math.floor(100000 + Math.random() * 900000);
  codeExpiry = Date.now() + 5 * 60 * 1000;
  const params = { to_email: email.trim(), verification_code: verificationCode };
  emailjs.send(EMAIL_SERVICE, EMAIL_TEMPLATE, params)
    .then(() => {
      alert("âœ… A verification code has been sent to your email to reset your password.");
      verifyCodeInput.style.display = 'block';
      passwordInput.placeholder = "Set a New Password";
      passwordInput.value = "";
      authTitle.textContent = "Reset Your Password";
      authSubtitle.textContent = "Enter the verification code & set a new password";
      sendCodeBtn.style.display = 'none';
      signupBtn.style.display = 'none';
      forgotLink.style.display = 'none';
      loginBtn.textContent = 'Verify & Reset';
    })
    .catch((err) => {
      console.error("EmailJS error:", err);
      alert("âš  Could not send verification email. Try again later.");
    });
});

/* ------------------------- View without Login (confirm) ------------------------- */
viewBtn.addEventListener('click', () => {
  // show custom confirm overlay
  guestConfirm.style.display = 'flex';
});
guestCancel.addEventListener('click', () => guestConfirm.style.display = 'none');
guestContinue.addEventListener('click', () => {
  guestConfirm.style.display = 'none';
  authPopup.style.display = 'none';
  // show logout hidden? no, guest isn't logged in so no logout button
});

/* ------------------------- Loading overlay logic ------------------------- */
function showLoadingAndLoad(email) {
  // 1) ensure logout visible
  logoutBtn.style.display = 'inline-block';

  // 2) hide the auth popup immediately so it doesn't remain after loading
  if (authPopup) authPopup.style.display = 'none';

  // 3) prepare overlay look
  loadingOverlay.style.display = 'flex';
  loadingOverlay.style.background = '#FFD166'; // yellow background while loading

  // keep loading-content readable
  const loadingContent = loadingOverlay.querySelector('.loading-content');
  if (loadingContent) loadingContent.style.color = '#2B1A55';
  const title = loadingOverlay.querySelector('.loading-title');
  const sub = loadingOverlay.querySelector('.loading-sub');
  const factsEl = loadingOverlay.querySelector('.loading-facts');
  if (title) title.style.color = '#2B1A55';
  if (sub) sub.style.color = '#2B1A55';
  if (factsEl) factsEl.style.color = '#2B1A55';

  // 4) Remove any previous single-card container (safety)
  const oldSingle = document.getElementById('ecoSingleCardWrapper');
  if (oldSingle) oldSingle.remove();

  // 5) Create single centered card (only one visible at a time)
  const wrapper = document.createElement('div');
  wrapper.id = 'ecoSingleCardWrapper';
  wrapper.style.width = '180px';
  wrapper.style.height = '110px';
  wrapper.style.margin = '10px auto';
  wrapper.style.borderRadius = '12px';
  wrapper.style.overflow = 'hidden';
  wrapper.style.position = 'relative';
  wrapper.style.display = 'flex';
  wrapper.style.alignItems = 'center';
  wrapper.style.justifyContent = 'center';
  wrapper.style.boxShadow = '0 6px 18px rgba(0,0,0,0.18)';
  wrapper.style.background = 'rgba(255,255,255,0.06)';

  const card = document.createElement('div');
  card.className = 'carousel-card';
  card.style.width = '100%';
  card.style.height = '100%';
  card.style.borderRadius = '10px';
  card.style.backgroundSize = 'cover';
  card.style.backgroundPosition = 'center';
  card.style.transition = 'opacity 600ms ease, transform 600ms ease';
  card.style.opacity = '0';
  card.style.transform = 'scale(0.98)';

  wrapper.appendChild(card);

  // insert wrapper before loading content so card sits just above text
  if (loadingContent && loadingContent.parentNode) {
    loadingOverlay.insertBefore(wrapper, loadingContent);
  } else {
    loadingOverlay.appendChild(wrapper);
  }

  // 6) Ensure we have images and facts
  const imgs = (Array.isArray(placeholderImages) && placeholderImages.length) ? placeholderImages : [];
  const facts = (Array.isArray(placeholderFacts) && placeholderFacts.length) ? placeholderFacts : ['Loading...'];

  if (imgs.length === 0) {
    // fallback hide quickly
    setTimeout(() => {
      loadingOverlay.style.display = 'none';
      if (wrapper) wrapper.remove();
      loadingOverlay.style.background = 'rgba(10,10,10,0.95)';
    }, 800);
    return;
  }

  // 7) Show one image at a time by changing card.backgroundImage + opacity fade
  let idx = 0;
  let factIdx = 0;
  const totalCycles = 2; // how many full loops through images
  let cycles = 0;

  // helper to set image with fade-in
  function showImageAt(i) {
    card.style.opacity = '0';
    card.style.transform = 'scale(0.985)';
    // short delay to allow fade-out
    setTimeout(() => {
      card.style.backgroundImage = `url('${imgs[i]}')`;
      // update fact text (fade)
      if (loadingFact) {
        loadingFact.style.opacity = '0';
        setTimeout(() => {
          loadingFact.textContent = facts[factIdx];
          loadingFact.style.opacity = '1';
        }, 200);
      }
      // fade-in
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'scale(1.02)';
      }, 60);
    }, 200);
  }

  // initial show
  factIdx = 0;
  showImageAt(idx);

  // schedule transitions: show next image every intervalMs
  const intervalMs = 1100;
  const handle = setInterval(() => {
    // advance indexes
    idx = (idx + 1) % imgs.length;
    factIdx = (factIdx + 1) % facts.length;

    showImageAt(idx);

    // when we complete a full loop (returned to 0), increment cycles
    if (idx === imgs.length - 1) cycles++;
    // stop after required cycles
    if (cycles >= totalCycles) {
      clearInterval(handle);
      // small pause then hide overlay and clean up
      setTimeout(() => {
        // hide overlay
        loadingOverlay.style.display = 'none';
        // restore background to original dark
        loadingOverlay.style.background = 'rgba(10,10,10,0.95)';
        // reset colors back to defaults (so next open is normal)
        if (loadingContent) loadingContent.style.color = '';
        if (title) title.style.color = '';
        if (sub) sub.style.color = '';
        if (factsEl) factsEl.style.color = '';
        // remove the single card wrapper to keep DOM clean
        const rem = document.getElementById('ecoSingleCardWrapper');
        if (rem) rem.remove();
        // After loading completes, the user is logged in (authPopup already hidden)
        // If you want to initialize dashboard content here, do it.
      }, 650);
    }
  }, intervalMs);
}


/* ------------------------- Logout ------------------------- */
logoutBtn.addEventListener('click', () => {
  if (!confirm("Logout and return to the login screen?")) return;
  clearCurrentUser();
  logoutBtn.style.display = 'none';
  // reset popup UI states
  signupMode = false; resetMode = false;
  verifyCodeInput.style.display = 'none';
  sendCodeBtn.style.display = 'none';
  loginBtn.textContent = 'Login';
  signupBtn.style.display = 'inline-block';
  forgotLink.style.display = 'inline-block';
  passwordInput.placeholder = "Password";
  emailInput.value = '';
  passwordInput.value = '';
  authTitle.textContent = "Welcome to EcoSmart";
  authSubtitle.textContent = "Please log in to continue";
  // show popup
  authPopup.style.display = 'flex';
});

/* ------------------------- Ensure user data after signup/login ------------------------- */
function ensureUserData(email) {
  const key = 'ecoUserData';
  const all = JSON.parse(localStorage.getItem(key) || "{}");
  if (!all[email]) {
    all[email] = { preferences: { theme: 'light' }, savedItems: [], createdAt: Date.now() };
    localStorage.setItem(key, JSON.stringify(all));
  }
}

/* ------------------------- End of script ------------------------- */
</script>
</body>
</html>








